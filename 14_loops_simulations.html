<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.179">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>UCSD Political Science Math Camp - 4&nbsp; Loops and Simulation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./15_non-wysiwyg.html" rel="next">
<link href="./13_data_wrangling_cleaning.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Loops and Simulation</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">UCSD Political Science Math Camp</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/UCSDPoliMathCamp/MathCamp/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">About this Booklet</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_warmup.html" class="sidebar-item-text sidebar-link">Warmup Questions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_prerequisites.html" class="sidebar-item-text sidebar-link">Prerequisites</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">I Introduction to R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_orientation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">RStudio and Reading in Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_data_wrangling_cleaning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_loops_simulations.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Loops and Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_non-wysiwyg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">LaTeX and Markdown</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">II Linear Algebra</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_vector_matrix.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Vector and Matrix</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_linear_systems.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Systems of Linear Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_matrix_inverse.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rank and Matrix Inverse</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">III Calculus</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_limits.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Limits</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_derivatives.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Differential Calculus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_intergrals.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Integral Calculus</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">IV Probability</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41_probability.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability Theory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42_distribution.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Summarizing Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./43_statistics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Learning from Data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./51_solutions-warmup.html" class="sidebar-item-text sidebar-link">Warmup Questions Solutions</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#generating-fake-data" id="toc-generating-fake-data" class="nav-link active" data-scroll-target="#generating-fake-data"><span class="toc-section-number">4.1</span>  Generating Fake Data</a>
  <ul>
<li><a href="#sample" id="toc-sample" class="nav-link" data-scroll-target="#sample">sample()</a></li>
  <li>
<a href="#sampling-from-distributions" id="toc-sampling-from-distributions" class="nav-link" data-scroll-target="#sampling-from-distributions">Sampling from Distributions</a>
  <ul class="collapse">
<li><a href="#binomial-distribution" id="toc-binomial-distribution" class="nav-link" data-scroll-target="#binomial-distribution">Binomial Distribution</a></li>
  <li><a href="#the-uniform-distribution" id="toc-the-uniform-distribution" class="nav-link" data-scroll-target="#the-uniform-distribution">The Uniform Distribution</a></li>
  <li><a href="#the-normal-distribution" id="toc-the-normal-distribution" class="nav-link" data-scroll-target="#the-normal-distribution">The Normal Distribution</a></li>
  </ul>
</li>
  <li><a href="#sampling-from-data" id="toc-sampling-from-data" class="nav-link" data-scroll-target="#sampling-from-data">Sampling from Data</a></li>
  <li><a href="#set.seed" id="toc-set.seed" class="nav-link" data-scroll-target="#set.seed">set.seed()</a></li>
  </ul>
</li>
  <li><a href="#loops" id="toc-loops" class="nav-link" data-scroll-target="#loops"><span class="toc-section-number">4.2</span>  Loops</a></li>
  <li>
<a href="#simulations" id="toc-simulations" class="nav-link" data-scroll-target="#simulations"><span class="toc-section-number">4.3</span>  Simulations</a>
  <ul>
<li><a href="#central-limit-theorem" id="toc-central-limit-theorem" class="nav-link" data-scroll-target="#central-limit-theorem">Central Limit Theorem</a></li>
  <li><a href="#power-analysis" id="toc-power-analysis" class="nav-link" data-scroll-target="#power-analysis">Power Analysis</a></li>
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping">Bootstrapping</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/UCSDPoliMathCamp/MathCamp/edit/main/14_loops_simulations.Rmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="simulation" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Loops and Simulation</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><p>Thus far in the course we have been working with real data. These data sets contained variables which correspond to tangible phenomena out in the world. While the bulk of social science research uses data of this sort, generating <em>fake</em> data can be surprisingly useful. Fake, or synthetic, data allows us to control every aspect of the <strong>data generating process (DGP)</strong>. By manually tweaking different parameters that govern the DGP, we can better understand how our statistical methods will perform on real data. In this chapter we will learn some of the tools in R used to simulate fake data.</p>
<section id="generating-fake-data" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="generating-fake-data">
<span class="header-section-number">4.1</span> Generating Fake Data</h2>
<p>First let’s load in our favorite packages.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-1_ff80c5c86212929ef6152b61bf8d4c04">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sample" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="sample">sample()</h3>
<p>The simplest way to generate random data in R is through the function <code>samples()</code>. The primary inputs to <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> are <code>x</code>, which is the set of values you want to draw from and <code>size</code>, which is the number of samples you want to draw. Let’s takes a look at an example.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-2_112fb861902c9dbc86e537bc35269c34">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a vector of character values</span></span>
<span><span class="va">my_animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"fish"</span>, <span class="st">"monkey"</span>, <span class="st">"parrot"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># From the set "my_animals", draw 2 at random</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_animals</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "parrot" "cat"   </code></pre>
</div>
</div>
<p>By default, <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> samples <em>without</em> replacement. This means that once a value from <code>x</code> is drawn, it will be ineligible to be drawn again. The following code gives us an error because <code>size = 100</code> is larger than the total number of values in <code>my_animals</code>.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-3_cf9f265205f037e2398e217ba5dcd934">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_animals</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in sample.int(length(x), size, replace, prob): cannot take a sample larger than the population when 'replace = FALSE'</code></pre>
</div>
</div>
<p>To fix this we need to sample <em>with</em> replacement by setting <code>replace = TRUE</code> inside <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code>.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-4_164ea68f5f22924e5b04e96398979c47">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_animals</span>, size <span class="op">=</span> <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "parrot" "monkey" "cat"    "fish"   "monkey" "parrot" "parrot" "dog"   
  [9] "fish"   "cat"    "parrot" "cat"    "fish"   "dog"    "cat"    "cat"   
 [17] "monkey" "dog"    "monkey" "dog"    "fish"   "parrot" "fish"   "fish"  
 [25] "dog"    "monkey" "monkey" "monkey" "fish"   "fish"   "cat"    "fish"  
 [33] "fish"   "parrot" "dog"    "fish"   "dog"    "monkey" "monkey" "fish"  
 [41] "monkey" "dog"    "fish"   "cat"    "cat"    "fish"   "monkey" "fish"  
 [49] "fish"   "dog"    "fish"   "cat"    "parrot" "monkey" "parrot" "cat"   
 [57] "fish"   "monkey" "monkey" "fish"   "fish"   "monkey" "cat"    "dog"   
 [65] "parrot" "parrot" "monkey" "dog"    "monkey" "fish"   "cat"    "cat"   
 [73] "dog"    "dog"    "dog"    "cat"    "monkey" "monkey" "cat"    "dog"   
 [81] "monkey" "parrot" "dog"    "monkey" "monkey" "dog"    "fish"   "fish"  
 [89] "cat"    "fish"   "dog"    "cat"    "fish"   "cat"    "parrot" "monkey"
 [97] "dog"    "monkey" "fish"   "parrot"</code></pre>
</div>
</div>
<p>The decision to sample with, or without, replacement depends on the particular DGP you want to simulate.</p>
<p>The <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function has an additional option which may be useful when generating random values. If you give <code>prob</code> a vector of values, <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> will draw samples from <code>x</code> in proportion to the values in <code>prob</code>. Each value in <code>prob</code> corresponds to the values in <code>x</code> that shares its position in the vector.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-5_d1fd4431cb039bdc9f8f486f90f4c69e">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">my_animals</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code above samples <code>my_animals</code> with 10% weight on <code>cat</code>, 20% weight on <code>dog</code> and <code>fish</code>, 40% weight on <code>monkey</code>, and 10% weight on <code>parrot</code>. We can confirm this worked by inspecting a bar graph of our <code>my_animals</code> data.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-6_15c1a1d708ecc3a386cf217b2589b78d">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ggplot requires the data be in tibble or data.frame form</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">my_animals</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_animals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="sampling-from-distributions" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="sampling-from-distributions">Sampling from Distributions</h3>
<p>The <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function is great for generating random data, but its use is limited by the fact that you have to manually specify the set of values <code>x</code> to draw from. For many common distributions of data (for example the Normal distribution), the set of possible values can range from negative infinity to positive infinity! To help us with this problem, base R comes with dozens of functions for drawing samples from well-known statistical distributions. The first one we will take a look at is <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> (<code>r</code> for “random” and <code>binom</code> for “binomial”).</p>
<section id="binomial-distribution" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="binomial-distribution">Binomial Distribution</h4>
<p>The <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> function takes three inputs: <code>n</code> for the number of draws we want, <code>size</code> for the number of binomial trails, and <code>prob</code> for the probability of a “success”. Don’t worry if some of these parameters are unfamiliar, we will cover the binomial distribution in much greater detail in the Probability section of the course. The easiest introduction to the binomial distribution is to set <code>size = 1</code> and <code>prob = 0.5</code>. This simulates flipping a coin and getting either a heads, <code>1</code>, or tails, <code>0</code> with equal probability. The code below generates 100 coin flips in this way.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-7_fa3b83f8380fa471a5bbfb83db75c227">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 1 0 0 1 1 0 0 1 1 0 1 1 1 1 0 0 0 1 1 1 1 0 0 1 0 1 1 0 0 1 0 0 0 0 0 1 1
 [38] 1 1 1 0 1 1 0 1 0 0 1 0 1 1 0 1 0 1 1 0 0 1 1 0 0 0 0 0 0 1 0 0 1 0 1 1 1
 [75] 0 0 1 1 1 0 1 1 1 1 0 1 1 1 0 1 0 0 1 1 1 1 0 1 1 1</code></pre>
</div>
</div>
<p>We can replicate the same data generating process using <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> with the following code.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-8_1deceb2176c80282b75ebd70a06d269a">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>       replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 1 1 1 1 1 0 1 1 0 1 1 1 1 1 0 1 0 0 0 1 0 1 1 1 0 1 1 0 0 1 0 0 0 1 1 1 1
 [38] 1 0 0 1 1 1 0 0 0 0 1 1 0 0 0 0 1 1 0 0 1 1 0 1 0 0 1 0 0 1 1 0 1 0 0 1 1
 [75] 1 1 1 1 1 0 0 1 1 1 1 0 1 1 0 1 0 1 1 1 0 1 1 1 0 1</code></pre>
</div>
</div>
<p>Let’s tweak the value for <code>prob</code> and see what happens.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-9_610cbeae34fffbf017e2ac3d5b27e6ee">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 1 1 0 1 1 0 0 1 0 1 1 0 1 1 1 0 0 0 1 1 1 1 0 1 0 1 1 0 1 1 1 1 1 1 1 1 1
 [38] 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 1 0 1 1 0 1
 [75] 1 1 1 1 1 1 1 1 0 1 0 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0</code></pre>
</div>
</div>
<p>Now there are way more <code>1</code>’s than <code>0</code>’s! A bar graph can help us visualize the proportions.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-10_3a7cda5a2083135e85f08df3ed3f412c">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">binomial_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">binomial_draws</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">binomial_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binomial Distribution: size = 1, prob = 0.8"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Differentiating <code>size</code> from <code>n</code> in <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> can be difficult to understand at first, so let’s experiment with the code to help figure it out. When we set <code>n = 100</code> and <code>size = 1</code> we were drawing 100 values from a trial that only ran once. Instead, if we reverse these numbers, we would be drawing a single value from 100 trials.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-11_eeb4c414afbf457086aab79aec93c9ec">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">100</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 49</code></pre>
</div>
</div>
<p>As you can see, the code above gives us a single value which is the sum of <code>1</code>’s from 100 trials. Because <code>prob = 0.5</code>, this number should be around 50.</p>
<p>Like in our example of sampling animal names with <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code>, it can be useful to create histograms to understand how sampling parameters affect the distribution of draws we get.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-12_630cb8180266f997c6d0b80d46914eb6">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">binomial_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                         size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                         prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk above creates an object called <code>binomial_draws</code> which holds 10,000 draws from a binomial distribution with seven trials and where the probability of a successful trial is 0.5. Let’s plot the values of <code>binomial_draws</code>.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-13_883d49bddee08e76dd61a94bdf99aac3">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">binomial_draws</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">binomial_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binomial Distribution: size = 7, prob = 0.5"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As you can see, the results of our random draws cluster around <code>3</code> and <code>4</code>. This is because the expected value of a binomial distribution is the total number of trials multiplied by the probability of a success. So that would be <span class="math inline">7 * 0.5 = 3.5</span> in this example.</p>
<p>Now let’s try changing <code>prob</code> to equal <code>0.8</code> in our simulation. The histogram below shows that the values of <code>binomial_draws</code> are clustered towards the higher end of the distribution with an average value of <span class="math inline">7 * 0.8 = 5.6</span>.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-14_831e717ad13a4e19248876258d73307b">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">binomial_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                         size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                         prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">binomial_draws</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">binomial_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binomial Distribution: size = 7, prob = 0.8"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="the-uniform-distribution" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-uniform-distribution">The Uniform Distribution</h4>
<p>Whereas the binomial distribution only returns whole numbers when we sample from it, samples drawn from a uniform distribution can be any real number between a specified minimum and maximum. The uniform distribution is useful when you want to generate random numbers with equal weight from within a pre-determined range. To generate random samples from the uniform distribution we use <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>. Like <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code>, the option <code>n</code> sets the number of random draws we want. We also need to specify our range by including a <code>max</code> and <code>min</code>.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-15_ffa4785badff9b6fe77c12088ccafd04">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generating random numbers from between 0 and 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.54337171 0.71002642 0.48195880 0.22570595 0.44268945 0.95055935
 [7] 0.50057119 0.33930531 0.15806949 0.10024940 0.80346667 0.34544123
[13] 0.58544779 0.29667138 0.51897068 0.52381265 0.86450114 0.69538650
[19] 0.50264880 0.69550948 0.60846622 0.73475118 0.01994567 0.37766717
[25] 0.12406208</code></pre>
</div>
</div>
<p>Let’s graph the random draws we get from a uniform distribution to better understand what’s taking place.</p>
<div class="cell" data-waring="false" data-hash="14_loops_simulations_cache/html/unnamed-chunk-16_8aefc76d9f18f17cdf7fe62909cd15d6">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">uniform_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10000</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">uniform_draws</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">uniform_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unfiform Distribution: min = 0, max = 1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The histogram above shows that values between 0 and 1 are all about equally likely, but we won’t get any draws that are less than 0 or greater than 1.</p>
</section><section id="the-normal-distribution" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-normal-distribution">The Normal Distribution</h4>
<p>The normal distribution creates the familiar bell-shaped curve and has two parameters: the mean which controls the center of the distribution, and the standard deviation which controls the width of the curve. We often model variables as following a normal distribution when we believe they should be drawn from some central value plus or minus some random “noise”. Normal distributions arise naturally when the data-generating process involves the addition of many small fluctuations via some process.</p>
<p>The function for generating samples from a normal distribution, <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code>, follows the same pattern we have seen with <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> and <code>ruinf()</code>. First we specify how many samples we want to draw <code>n</code>, then we specify the parameters <code>mean</code> and <code>sd</code> of the normal distribution we want to draw from.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-17_8b66e22229b61b5dfaff389017aaf15e">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  0.701401693  0.563848586  0.083924053  0.583872090 -2.099774785
  [6]  0.110344339 -0.787723239 -0.333248439  0.550758584  0.714693017
 [11]  0.120548638  0.150896298 -0.512840980  0.867312927 -0.346141983
 [16] -0.247085534 -0.641254732 -0.188211065 -0.683860328 -1.081965622
 [21]  0.977785717  1.160655145  0.162338679  0.782390816 -1.763856075
 [26] -0.564634301  2.213519318 -0.477646310 -0.004801969  0.094277717
 [31]  0.778655437  1.727779901  0.586957584 -0.967434894 -1.328433688
 [36] -0.245594927  1.629886013  0.590545573 -0.631178866 -1.501219305
 [41] -0.179582084  0.511943231  0.436229912 -0.490867638 -0.667737678
 [46]  1.111207564 -0.462655115  0.153127425 -0.763495384  0.504704055
 [51]  0.159434501 -2.095171559 -0.406393021  0.088125564  0.201007399
 [56] -0.628663068  1.759631869  1.150681772  0.375750165  0.938472032
 [61]  1.560115129 -1.156157677 -0.235717709  0.022263851 -0.532578110
 [66] -1.613624244  0.709041363  1.262709215  1.400904670 -0.910794053
 [71]  0.234888338 -0.795670369 -0.696388954 -0.580520291 -2.437246699
 [76] -0.599461865  1.868526238  0.239810630  1.930599107  1.818698435
 [81]  1.724502768 -0.939630249 -0.667630396 -0.304484103 -0.749651786
 [86]  0.260659673  2.084776203  0.774098464  0.478170287 -0.015065348
 [91]  0.755561815 -1.698254712 -0.392527625 -0.179050762  1.521890755
 [96]  0.767081993 -0.506149202 -0.718145288  0.889710784 -0.425267586</code></pre>
</div>
</div>
<p>Like the uniform distribution, draws from the normal distribution can be any real number. It may be difficult to see from the random draws above that values close to the mean of 0 are more likely than more extreme values. So let’s take a look at the distribution graphically.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-18_6a578986df71bfd68a077096743d4333">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">normal_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">normal_draws</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">normal_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Normal Distribution: mean = 0, sd = 1"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A normal distribution that looks like the one above (mean = 0, standard deviation = 1) is often called a “Standard Normal” distribution, and you will come across it all the time in statistics. Let’s take a look at some other normal distributions by varying their mean and standard deviation values.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-19_a101f672375edfcd9908f045ae73ca3c">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># rnorm defaults to mean = 0, sd = 1 if those options are left blank</span></span>
<span><span class="va">normal_minus_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">normal_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">normal_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combining the draws into a single "long" data frame</span></span>
<span><span class="va">normal_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">normal_minus_one</span>,</span>
<span>                     <span class="va">normal_zero</span>,</span>
<span>                     <span class="va">normal_one</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"distribution"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"normal_draws"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">normal_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">normal_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">90</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">distribution</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Changing the value for <code>mean</code> shifts the distribution along the x-axis but the spread of the data remains the same.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-20_3393cadebeb6e0e431a945960d25fb67">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">normal_narrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">normal_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">normal_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span>, sd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">normal_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">normal_narrow</span>,</span>
<span>                     <span class="va">normal_standard</span>,</span>
<span>                     <span class="va">normal_wide</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"distribution"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"normal_draws"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">normal_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">normal_draws</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">90</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">distribution</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Changing the value for only <code>sd</code> keeps each distribution centered at 0, but makes the data more or less spread out.</p>
</section></section><section id="sampling-from-data" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="sampling-from-data">Sampling from Data</h3>
<p>While we’re discussing sampling to create fake data, it’s also handy to know how to sample from real data. Sometimes you will be working with data sets that are so large that you’ll want to test your code on smaller portions first. Or you may want to perform sampling on data when creating bootstrapped confidence intervals (a topic we will return to at the end of this chapter).</p>
<p>Let’s read in the “county_elections.csv” data once again.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-21_6549ba980b7cd5169a1bc03ae1411414">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">county_elections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"county_elections.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3114 Columns: 27
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (2): state_abbrv, county
dbl (25): countyCode, trump16, clinton16, otherpres16, romney12, obama12, ot...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Dplyr contains a function called <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n()</a></code> which lets you easily draw a number of random rows from your data.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-22_66b7706326cde6eb6d476609edc5cb08">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">county_elections</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 27
   state_abbrv county    count…¹ trump16 clint…² other…³ romne…⁴ obama12 other…⁵
   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 WI          Winnebago   55139   43448   37054    6642   42122   45449    1602
 2 SD          Custer      46033    3293    1121     307    3062    1335     123
 3 SD          Hutchins…   46067    2517     692     156    2451     923      51
 4 NC          Cleveland   37045   28479   14964    1230   25793   17062     485
 5 TX          Burleson    48051    5316    1491     153    4671    1705      80
 6 MT          Roosevelt   30085    1797    1560     295    1514    2086      72
 7 IL          Henderson   17071    2155    1155     208    1541    1978      49
 8 TN          Cheatham    47021   11297    3878     749   10268    4659     255
 9 IL          Stephens…   17177   11083    7768    1492   10512   10165     378
10 KS          Allen       20001    3651    1433     370    3316    1869     125
# … with 18 more variables: total_population &lt;dbl&gt;, cvap &lt;dbl&gt;,
#   white_pct &lt;dbl&gt;, black_pct &lt;dbl&gt;, hispanic_pct &lt;dbl&gt;, nonwhite_pct &lt;dbl&gt;,
#   foreignborn_pct &lt;dbl&gt;, female_pct &lt;dbl&gt;, age29andunder_pct &lt;dbl&gt;,
#   age65andolder_pct &lt;dbl&gt;, median_hh_inc &lt;dbl&gt;, clf_unemploy_pct &lt;dbl&gt;,
#   lesshs_pct &lt;dbl&gt;, lesscollege_pct &lt;dbl&gt;, lesshs_whites_pct &lt;dbl&gt;,
#   lesscollege_whites_pct &lt;dbl&gt;, rural_pct &lt;dbl&gt;, ruralurban_cc &lt;dbl&gt;, and
#   abbreviated variable names ¹​countyCode, ²​clinton16, ³​otherpres16, …
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>Alternatively, we can use <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac()</a></code> to specify how many random rows to draw based on a proportion of total rows.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-23_6a175625c0bc6b09a6ae08129cfe2899">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">county_elections</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="co"># Return 1% of the final data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 27
   state_abbrv county    count…¹ trump16 clint…² other…³ romne…⁴ obama12 other…⁵
   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 TN          Giles       47055    7970    2917     250    6915    3760     124
 2 OK          Kay         40071   12172    3738     893   11499    4627       0
 3 ID          Bonner      16017   13343    5819    1781   11367    6500     669
 4 NY          Cattarau…   36009   19692    9497    1972   14655   12040    3072
 5 OK          Logan       40083   13633    4248    1098   12314    4724       0
 6 TN          Blount      47009   37443   12100    2665   35441   12934     859
 7 AL          Covington    1039   13267    2387     286   12153    3158     112
 8 NE          Knox        31107    3188     720     207    2885    1059      92
 9 TX          Tyler       48457    6624    1248     144    5910    1668      76
10 AR          Pulaski      5119   61257   89574    8945   68984   87248    3149
# … with 21 more rows, 18 more variables: total_population &lt;dbl&gt;, cvap &lt;dbl&gt;,
#   white_pct &lt;dbl&gt;, black_pct &lt;dbl&gt;, hispanic_pct &lt;dbl&gt;, nonwhite_pct &lt;dbl&gt;,
#   foreignborn_pct &lt;dbl&gt;, female_pct &lt;dbl&gt;, age29andunder_pct &lt;dbl&gt;,
#   age65andolder_pct &lt;dbl&gt;, median_hh_inc &lt;dbl&gt;, clf_unemploy_pct &lt;dbl&gt;,
#   lesshs_pct &lt;dbl&gt;, lesscollege_pct &lt;dbl&gt;, lesshs_whites_pct &lt;dbl&gt;,
#   lesscollege_whites_pct &lt;dbl&gt;, rural_pct &lt;dbl&gt;, ruralurban_cc &lt;dbl&gt;, and
#   abbreviated variable names ¹​countyCode, ²​clinton16, ³​otherpres16, …
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>Performing stratified sampling is very easy using the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function we introduced in the last chapter. The code below draws one random row (i.e.&nbsp;county) from each US state.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-24_49c2460d80066237336765b46956d742">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">county_elections</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state_abbrv</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 27
# Groups:   state_abbrv [50]
   state_abbrv county    count…¹ trump16 clint…² other…³ romne…⁴ obama12 other…⁵
   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 AL          Elmore       1051   27634    8443    1183   26253    8954     278
 2 AR          Sharp        5135    5407    1472     370    4921    2092     270
 3 AZ          Cochise      4003   28092   17450    4473   29497   18546     960
 4 CA          Napa         6055   17411   39199    4762   19526   35870    1572
 5 CO          Montezuma    8083    7853    3973    1032    7401    4542     375
 6 CT          Tolland      9013   34194   38506    4724   19768   25957     863
 7 DC          District…   11001   12723  282830   15715   21381  267070    5313
 8 DE          Sussex      10005   62611   39333    4064   52119   39975    1135
 9 FL          Marion      12083  107833   62041    4826   93043   66831    1511
10 GA          Fannin      13111    9632    1923     257    7857    2028     132
# … with 40 more rows, 18 more variables: total_population &lt;dbl&gt;, cvap &lt;dbl&gt;,
#   white_pct &lt;dbl&gt;, black_pct &lt;dbl&gt;, hispanic_pct &lt;dbl&gt;, nonwhite_pct &lt;dbl&gt;,
#   foreignborn_pct &lt;dbl&gt;, female_pct &lt;dbl&gt;, age29andunder_pct &lt;dbl&gt;,
#   age65andolder_pct &lt;dbl&gt;, median_hh_inc &lt;dbl&gt;, clf_unemploy_pct &lt;dbl&gt;,
#   lesshs_pct &lt;dbl&gt;, lesscollege_pct &lt;dbl&gt;, lesshs_whites_pct &lt;dbl&gt;,
#   lesscollege_whites_pct &lt;dbl&gt;, rural_pct &lt;dbl&gt;, ruralurban_cc &lt;dbl&gt;, and
#   abbreviated variable names ¹​countyCode, ²​clinton16, ³​otherpres16, …
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
</section><section id="set.seed" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="set.seed">set.seed()</h3>
<p>If you have been running the code chunks above yourself, you may have noticed that random values you got differed from those printed in this chapter. In fact, each time you run a function like <code>rnorm(n = 100, mean = 0, sd = 1)</code> you will get different results. The function <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> is R’s way of making sure that the results of your random simulations are the same for others, and for yourself if you re-run your code. This is an important part of making sure the results of your statistical analyses are reproducible.</p>
<p>Simply put any number inside <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> and R’s randomness will become tied to that particular number.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-25_2a2eeb3ff19c28991a4ad0daace827c6">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10071992</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_animals</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "monkey" "dog"    "parrot"</code></pre>
</div>
</div>
<p>Running the chunk of code above should output <code>"parrot" "cat" "monkey"</code> each time it is run and across different computers, or different versions of R.</p>
</section></section><section id="loops" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="loops">
<span class="header-section-number">4.2</span> Loops</h2>
<p>Loops are handy tools for running the same process repeatedly in R. For example, let’s say we wanted to print out the name of every animal in our vector of <code>my_animals</code>. The tedious way would be to type out the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> function for each animal as in the code below.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-26_685e540f26f2c1ea950925c19f1cd214">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"cat"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cat"</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"dog"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dog"</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"monkey"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "monkey"</code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"parrot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "parrot"</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"fish"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "fish"</code></pre>
</div>
</div>
<p>But with loops we can perform the same task in a much more concise fashion.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-27_cb7791d456a2b4e47fdf8197dc8d233e">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"monkey"</span>, <span class="st">"parrot"</span>, <span class="st">"fish"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">animal</span> <span class="kw">in</span> <span class="va">my_animals</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">animal</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cat"
[1] "dog"
[1] "monkey"
[1] "parrot"
[1] "fish"</code></pre>
</div>
</div>
<p>The basic structure of a loop is shown in the code chunk below. The object <code>set_of_things</code> should be some object in R which holds many values (such as a vector, a data frame, a list, or a matrix). The <code>thing</code> object refers to each element in <code>set_of_things</code> and changes its value each time the loop goes through a single iteration. Typically you will refer to <code>thing</code> in the body of your loop, such as in the function <code>do_something_to()</code>. A loop structured like this runs until every element in <code>set_of_things</code> is iterated through.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-28_f45ae1a9bd360e5e091501210b143f97">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">thing</span> <span class="kw">in</span> <span class="va">set_of_things</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">do_something_to</span><span class="op">(</span><span class="va">thing</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is very common to use loops as a way to run a set of R commands N times, where N is some integer greater than 1. The easiest way to do this is to create a sequence of numbers using <code>:</code> as shown below.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-29_d5f36afb8e4c99d7ef63cec45dfa7afa">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
</div>
<p>The object <code>1:10</code> is then what we will insert into the <code>set_of_things</code> position in our loop in order to iterate through each number in the sequence. When you construct a loop in this manner you should name your <code>thing</code> object <code>i</code>. This is the standard style taken from mathematical indexing, and helps readers of your code better understand the purpose of your loop.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-30_5bdb894b12c59081b01492eae1a274ca">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 4
[1] 9
[1] 16
[1] 25
[1] 36
[1] 49
[1] 64
[1] 81
[1] 100</code></pre>
</div>
</div>
<p>So far our loops have only printed out their results in the console, but have not given us much to work with afterwards. To save the output of your loop you will typically need to initialize some “holder” object ahead of running the loop. Then, within each iteration of the loop, you can save the result inside the “holder” object.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-31_aa1ddc0acf7eaf9fb83ab4834074ff52">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">holder</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Use NULL to create an empty object</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">holder</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk above iterates through each number from 1 to 100, squares that number, then saves it in the <code>i</code>th position of the <code>holder</code> object. We can then take the vector of values stored in <code>holder</code> and access them as we would any object saved in our R Environment.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-32_e685d1d6ab19fe7e9117e5209b8146ae">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">holder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]     1     4     9    16    25    36    49    64    81   100   121   144
 [13]   169   196   225   256   289   324   361   400   441   484   529   576
 [25]   625   676   729   784   841   900   961  1024  1089  1156  1225  1296
 [37]  1369  1444  1521  1600  1681  1764  1849  1936  2025  2116  2209  2304
 [49]  2401  2500  2601  2704  2809  2916  3025  3136  3249  3364  3481  3600
 [61]  3721  3844  3969  4096  4225  4356  4489  4624  4761  4900  5041  5184
 [73]  5329  5476  5625  5776  5929  6084  6241  6400  6561  6724  6889  7056
 [85]  7225  7396  7569  7744  7921  8100  8281  8464  8649  8836  9025  9216
 [97]  9409  9604  9801 10000</code></pre>
</div>
</div>
<p>Alternatively, we could write the functionally-equivalent code chunk below.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-33_27fb2b359d8b79ae50c638fa75117066">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">holder</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">holder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">holder</span>, <span class="va">i</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are using the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function to <em>combine</em> the current value of the loop’s iteration with everything that came before it in the <code>holder</code> object. This method is more flexible than indexing with <code>[i]</code>, but can be computationally slower to run because the <code>holder</code> object is re-writen by R each time the loop iterates.</p>
</section><section id="simulations" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="simulations">
<span class="header-section-number">4.3</span> Simulations</h2>
<p>In the final section of this chapter we will look at a few examples of simulations that have real-world applications. The basic idea behind each of these simulations is to use R’s random sampling functions (such as <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> or <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>) <em>within</em> a loop to generate hundreds or thousands of synthetic data points. In the real world we only get one realization of our data to analyze, but common statistical techniques are based on imagining large numbers of repeated samples of data from the same population. Simulations built in R can therefore help us approximate this process.</p>
<section id="central-limit-theorem" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="central-limit-theorem">Central Limit Theorem</h3>
<p>The Central Limit Theorem (CLT) is invoked all the time in frequentist statistical methods. In lay terms, it states that if we calculate the means of many samples from a single population, the distribution of these means will be normally distributed. And this is true regardless (with exceptions) of what the distribution of the population looks like. If this sounds like magic to you, let’s use a simulation to prove it.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-34_c4a4c456346edf1c2083f9558ffbff8d">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First we will set the number of simulations we want to run with <code>n_sims &lt;- 1000</code>. Generally, running more simulations will produce more accurate results, but doing so will also take more computation time. The object <code>means</code> will be our “holder” object used to store the output of each loop iteration. We set its value to <code>NULL</code> initially because it starts empty.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-35_224cc45a33060b76b9dea386f264e273">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">means</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The loop above contains everything we need to simulate the CLT in action. By setting <code>for (i in 1:n_sims)</code> we make the loop run <code>n_sims</code> times. Within each iteration we generate a new vector of fake data called <code>sample_data</code> which contains 100 draws of a uniform distribution whose range is from -1 to 1. We then take the average value of <code>sample_data</code> with the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> function and store that into the <code>i</code>th position of the <code>means</code> holder object.</p>
<p>Now let’s graph our results!</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-36_6b4888c5d424c505363b601a66d88601">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">means</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Means from Simulated Uniform Random Samples"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As you can see, the distribution of mean values inside <code>means</code> follow the familiar bell-shaped curve of a normal distribution—despite the fact that the random samples were drawn from a uniform distribution. Amazing!</p>
</section><section id="power-analysis" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="power-analysis">Power Analysis</h3>
<p>Power analysis is a method used to figure out how big of a sample you need before running an experiment. Smaller sample sizes make it more difficult to detect an effect of some treatment, but budget constraints often limit how large of a sample we can acquire. To perform a power analysis, you need to have an idea of the possible effect sizes of your treatment, as well as your false-negative threshold (i.e.&nbsp;“if there really is an effect from the treatment, what proportion of times should my experiment detect it?”). Statisticians have developed fancy formulas for calculating optimal sample sizes based on these inputs. But it is much easier to instead write R code which simulates running your particular experiment thousands of times.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-37_a883099c4c8d4c43f280b0d9f08e3566">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">effect</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As in the Central Limit Theorem example, we will set <code>n_sims &lt;- 10000</code>. Our “holder” object will be called <code>p_values</code> this time because that is what we will be extracting from every iteration of our loop below. Lastly we need to specify a treatment effect, <code>effect</code> and sample size for our experiment <code>sample_size</code>. The beauty of running simulations in R is that we can easily play around with different values of <code>effect</code> and <code>sample_size</code> and check out the new results.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-38_9c1554266f60d8eb8f2d50b3db5f1f1a">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Setting seed so we all get the same results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10071992</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span> <span class="op">/</span> <span class="fl">2</span>, mean <span class="op">=</span> <span class="va">effect</span><span class="op">)</span></span>
<span>  <span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span> <span class="op">/</span> <span class="fl">2</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">power_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">treated</span>, <span class="va">control</span><span class="op">)</span></span>
<span>  <span class="va">p_values</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">power_test</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The loop above simulates a possible experimental design. First we create two vectors of outcomes, one for the treated group and one for our control group. The number of samples from each group is our <code>sample_size</code> divided by two, and each group is drawn from a normal distribution using <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code>. However, you will notice that the <code>treated</code> group is being drawn from a normal distribution with mean equal to our specified <code>effect</code> of 0.5, whereas the <code>control</code> group is drawn from a normal distribution with <code>mean = 0</code>. In our simulated experiment, we <em>know</em> that the treatment has some effect because we generated the data to ensure it does! The normal distribution for each group has a standard deviation of one (the default in <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code>). The variation in outcomes has major implications for our power analysis, but we will omit dealing with that here for simplicity.</p>
<p>After generating sample outcomes for our <code>treated</code> and <code>control</code> groups, we perform a simple t-test to compare the means of each group and store the results in an object called <code>power_test</code>. Then we extract the p-value from the t-test using <code>$p.value</code> and save it into the <code>i</code>th position of the <code>p_values</code> holder object. If <code>power_test$p.value</code> is less than the conventional level of 0.05, then the simulated experiment has successfully detected the effect of the treatment. With our vector of 10,000 <code>p_values</code> in hand, we can now calculate the proportion of them which are below 0.05 using the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> function.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-39_96e70d772ad5c5570babb4e9e223a495">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p_values</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4038</code></pre>
</div>
</div>
<p>It looks like our experiment (with effect size of 0.5 and sample size of 50) was only able to detect a true effect of the treatment about 40% of the time. Ideally we would like this number to above 80% so we will probably need to recruit more than 50 participants for our experiment if we hypothesize that the treatment has a 0.5 standardized effect.</p>
</section><section id="bootstrapping" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="bootstrapping">Bootstrapping</h3>
<p>Bootstrapping is a technique used to calculate uncertainty regions around our statistical estimates. It approximates a confidence interval by re-sampling the underlying data (<em>with replacement</em>) thousands of times and refitting the statistical model to each of these samples. Bootstrapping is useful when calculating confidence intervals analytically is challenging or impossible (which may occur for complicated models).</p>
<p>In this example we will be looking at the coefficient estimate for a linear regression with median household income as the dependent variable and high school percentage as the independent variable. Recall that these variables come from the <code>county_elections</code> data.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-40_7dfef3827fdc901a5b15fbfd08c58217">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will set <code>n_sims</code> to only 1,000 here because the re-sampling process can take a while. The holder <code>estimates</code> will be used to store the coefficient estimates from our linear regression.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-41_50950d408e1b08fa8ae98bcf8d51b587">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">county_sample</span> <span class="op">&lt;-</span> <span class="va">county_elections</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">county_elections</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">median_hh_inc</span> <span class="op">~</span> <span class="va">lesshs_pct</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">county_sample</span><span class="op">)</span></span>
<span>  <span class="va">estimates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first step of our simulation is to create a <code>county_sample</code> object which contains random rows from the main <code>county_elections</code> data set. Inside <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n()</a></code> we set <code>size = nrow(county_elections)</code> to generate a sample which has the same number of rows as the original data set. Crucially, we also set <code>replace = TRUE</code> so that it is possible to include the same row multiple times in our sampled data. If you think it seems weird to replicate rows like this, you’re not alone! Yet somehow this procedure works to produce valid confidence regions around the estimated coefficient.</p>
<p>Next we create an object <code>lm_model</code> which stores the linear regression fit on the <code>county_sample</code> data. We can extract the coefficient/slope between <code>lesshs_pct</code> and <code>median_hh_inc</code> using the verbose <code>summary(lm_model)$coef[[2]]</code> (for easier ways to extract regression coefficients see the <a href="https://broom.tidymodels.org/">broom package</a>).</p>
<p>Finally let’s take a look at all these coefficient values stored in <code>estimates</code> graphically.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-42_3bc33fe2d9b0eac49238a1118e8a7be7">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bootstrap_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimates</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                 fill <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Bootstrapped Estimates of the Regression Coefficient"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bootstrap_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Sometimes it is handy to save a ggplot graph in an object like we do with <code>bootstrap_plot</code>. This will allow us to add on subsequent geoms without re-writing the entire ggplot code.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-43_0eccfd9e7c791af074f38c3cafc59beb">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">median_hh_inc</span> <span class="op">~</span> <span class="va">lesshs_pct</span>,</span>
<span>               data <span class="op">=</span> <span class="va">county_elections</span><span class="op">)</span></span>
<span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">standard_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How do our simulated bootstrapped estimates, fit on random samples of the <code>county_elections</code> data, compare to the results of a model fit to the original data set? The code chunk above runs the linear regression model on the full <code>county_elections</code> data and saves the single estimated coefficient and standard error.</p>
<div class="cell" data-hash="14_loops_simulations_cache/html/unnamed-chunk-44_af7db9317bf4544b1043156ec063371c">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bootstrap_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"maroon"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="va">standard_error</span> <span class="op">*</span> <span class="fl">1.96</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkcyan"</span>, size <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="va">standard_error</span> <span class="op">*</span> <span class="fl">1.96</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkcyan"</span>, size <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Full sample estimate in maroon\n95% confidence interval in cyan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14_loops_simulations_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Adding these values to our <code>bootstrap_plot</code> using <code>+ geom_vline()</code> we can see that the bootstrapped estimates correspond neatly to the full-data model! The center of the bootstrapped distribution is right on the full-data model estimate of the coefficient, and roughly 95% of our simulated results fall within <span class="math inline">\pm 1.96 \times \mathrm{StandardError}</span> (the definition of a confidence interval for a linear regression coefficient).</p>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./13_data_wrangling_cleaning.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./15_non-wysiwyg.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">LaTeX and Markdown</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb74" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Loops and Simulation {#simulation}</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>Thus far in the course we have been working with real data. These data sets contained variables which correspond to tangible phenomena out in the world. While the bulk of social science research uses data of this sort, generating *fake* data can be surprisingly useful. Fake, or synthetic, data allows us to control every aspect of the **data generating process (DGP)**. By manually tweaking different parameters that govern the DGP, we can better understand how our statistical methods will perform on real data. In this chapter we will learn some of the tools in R used to simulate fake data.</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generating Fake Data</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>First let's load in our favorite packages.</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="fu">### sample() {.unnumbered}</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>The simplest way to generate random data in R is through the function <span class="in">`samples()`</span>. The primary inputs to <span class="in">`sample()`</span> are <span class="in">`x`</span>, which is the set of values you want to draw from and <span class="in">`size`</span>, which is the number of samples you want to draw. Let's takes a look at an example.</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of character values</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>my_animals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"fish"</span>, <span class="st">"monkey"</span>, <span class="st">"parrot"</span>)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="co"># From the set "my_animals", draw 2 at random</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> my_animals, <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>By default, <span class="in">`sample()`</span> samples *without* replacement. This means that once a value from <span class="in">`x`</span> is drawn, it will be ineligible to be drawn again. The following code gives us an error because <span class="in">`size = 100`</span> is larger than the total number of values in <span class="in">`my_animals`</span>.</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> my_animals, <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>To fix this we need to sample *with* replacement by setting <span class="in">`replace = TRUE`</span> inside <span class="in">`sample()`</span>. </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> my_animals, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>The decision to sample with, or without, replacement depends on the particular DGP you want to simulate. </span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sample()`</span> function has an additional option which may be useful when generating random values. If you give <span class="in">`prob`</span> a vector of values, <span class="in">`sample()`</span> will draw samples from <span class="in">`x`</span> in proportion to the values in <span class="in">`prob`</span>. Each value in <span class="in">`prob`</span> corresponds to the values in <span class="in">`x`</span> that shares its position in the vector.</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>my_animals <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> my_animals,</span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">1000</span>,</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>)</span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>The code above samples <span class="in">`my_animals`</span> with 10% weight on <span class="in">`cat`</span>, 20% weight on <span class="in">`dog`</span> and <span class="in">`fish`</span>, 40% weight on <span class="in">`monkey`</span>, and 10% weight on <span class="in">`parrot`</span>. We can confirm this worked by inspecting a bar graph of our <span class="in">`my_animals`</span> data.</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot requires the data be in tibble or data.frame form</span></span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(my_animals) <span class="sc">|&gt;</span> </span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> my_animals)) <span class="sc">+</span></span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling from Distributions {.unnumbered}</span></span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sample()`</span> function is great for generating random data, but its use is limited by the fact that you have to manually specify the set of values <span class="in">`x`</span> to draw from. For many common distributions of data (for example the Normal distribution), the set of possible values can range from negative infinity to positive infinity! To help us with this problem, base R comes with dozens of functions for drawing samples from well-known statistical distributions. The first one we will take a look at is <span class="in">`rbinom()`</span> (<span class="in">`r`</span> for "random" and <span class="in">`binom`</span> for "binomial").</span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binomial Distribution {.unnumbered}</span></span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a>The <span class="in">`rbinom()`</span> function takes three inputs: <span class="in">`n`</span> for the number of draws we want, <span class="in">`size`</span> for the number of binomial trails, and <span class="in">`prob`</span> for the probability of a "success". Don't worry if some of these parameters are unfamiliar, we will cover the binomial distribution in much greater detail in the Probability section of the course. The easiest introduction to the binomial distribution is to set <span class="in">`size = 1`</span> and <span class="in">`prob = 0.5`</span>. This simulates flipping a coin and getting either a heads, <span class="in">`1`</span>, or tails, <span class="in">`0`</span> with equal probability. The code below generates 100 coin flips in this way.</span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-79"><a href="#cb74-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-80"><a href="#cb74-80" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb74-81"><a href="#cb74-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-82"><a href="#cb74-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-83"><a href="#cb74-83" aria-hidden="true" tabindex="-1"></a>We can replicate the same data generating process using <span class="in">`sample()`</span> with the following code.</span>
<span id="cb74-84"><a href="#cb74-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-87"><a href="#cb74-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-88"><a href="#cb74-88" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb74-89"><a href="#cb74-89" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="dv">100</span>,</span>
<span id="cb74-90"><a href="#cb74-90" aria-hidden="true" tabindex="-1"></a>       <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-91"><a href="#cb74-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-92"><a href="#cb74-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-93"><a href="#cb74-93" aria-hidden="true" tabindex="-1"></a>Let's tweak the value for <span class="in">`prob`</span> and see what happens.</span>
<span id="cb74-94"><a href="#cb74-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-97"><a href="#cb74-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-98"><a href="#cb74-98" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.8</span>)</span>
<span id="cb74-99"><a href="#cb74-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-100"><a href="#cb74-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-101"><a href="#cb74-101" aria-hidden="true" tabindex="-1"></a>Now there are way more <span class="in">`1`</span>'s than <span class="in">`0`</span>'s! A bar graph can help us visualize the proportions.</span>
<span id="cb74-102"><a href="#cb74-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-105"><a href="#cb74-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-106"><a href="#cb74-106" aria-hidden="true" tabindex="-1"></a>binomial_draws <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.8</span>)</span>
<span id="cb74-107"><a href="#cb74-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-108"><a href="#cb74-108" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(binomial_draws) <span class="sc">|&gt;</span> </span>
<span id="cb74-109"><a href="#cb74-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> binomial_draws)) <span class="sc">+</span></span>
<span id="cb74-110"><a href="#cb74-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb74-111"><a href="#cb74-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb74-112"><a href="#cb74-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Binomial Distribution: size = 1, prob = 0.8"</span>)</span>
<span id="cb74-113"><a href="#cb74-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-114"><a href="#cb74-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-115"><a href="#cb74-115" aria-hidden="true" tabindex="-1"></a>Differentiating <span class="in">`size`</span> from <span class="in">`n`</span> in <span class="in">`rbinom()`</span> can be difficult to understand at first, so let's experiment with the code to help figure it out. When we set <span class="in">`n = 100`</span> and <span class="in">`size = 1`</span> we were drawing 100 values from a trial that only ran once. Instead, if we reverse these numbers, we would be drawing a single value from 100 trials.</span>
<span id="cb74-116"><a href="#cb74-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-119"><a href="#cb74-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-120"><a href="#cb74-120" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb74-121"><a href="#cb74-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-122"><a href="#cb74-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-123"><a href="#cb74-123" aria-hidden="true" tabindex="-1"></a>As you can see, the code above gives us a single value which is the sum of <span class="in">`1`</span>'s from 100 trials. Because <span class="in">`prob = 0.5`</span>, this number should be around 50.</span>
<span id="cb74-124"><a href="#cb74-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-125"><a href="#cb74-125" aria-hidden="true" tabindex="-1"></a>Like in our example of sampling animal names with <span class="in">`sample()`</span>, it can be useful to create histograms to understand how sampling parameters affect the distribution of draws we get. </span>
<span id="cb74-126"><a href="#cb74-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-129"><a href="#cb74-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-130"><a href="#cb74-130" aria-hidden="true" tabindex="-1"></a>binomial_draws <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">10000</span>,</span>
<span id="cb74-131"><a href="#cb74-131" aria-hidden="true" tabindex="-1"></a>                         <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb74-132"><a href="#cb74-132" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb74-133"><a href="#cb74-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-134"><a href="#cb74-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-135"><a href="#cb74-135" aria-hidden="true" tabindex="-1"></a>The code chunk above creates an object called <span class="in">`binomial_draws`</span> which holds 10,000 draws from a binomial distribution with seven trials and where the probability of a successful trial is 0.5. Let's plot the values of <span class="in">`binomial_draws`</span>.</span>
<span id="cb74-136"><a href="#cb74-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-139"><a href="#cb74-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-140"><a href="#cb74-140" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(binomial_draws) <span class="sc">|&gt;</span> </span>
<span id="cb74-141"><a href="#cb74-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> binomial_draws)) <span class="sc">+</span></span>
<span id="cb74-142"><a href="#cb74-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb74-143"><a href="#cb74-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb74-144"><a href="#cb74-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Binomial Distribution: size = 7, prob = 0.5"</span>)</span>
<span id="cb74-145"><a href="#cb74-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-146"><a href="#cb74-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-147"><a href="#cb74-147" aria-hidden="true" tabindex="-1"></a>As you can see, the results of our random draws cluster around <span class="in">`3`</span> and <span class="in">`4`</span>. This is because the expected value of a binomial distribution is the total number of trials multiplied by the probability of a success. So that would be $7 * 0.5 = 3.5$ in this example. </span>
<span id="cb74-148"><a href="#cb74-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-149"><a href="#cb74-149" aria-hidden="true" tabindex="-1"></a>Now let's try changing <span class="in">`prob`</span> to equal <span class="in">`0.8`</span> in our simulation. The histogram below shows that the values of <span class="in">`binomial_draws`</span> are clustered towards the higher end of the distribution with an average value of $7 * 0.8 = 5.6$.</span>
<span id="cb74-150"><a href="#cb74-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-153"><a href="#cb74-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-154"><a href="#cb74-154" aria-hidden="true" tabindex="-1"></a>binomial_draws <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">10000</span>,</span>
<span id="cb74-155"><a href="#cb74-155" aria-hidden="true" tabindex="-1"></a>                         <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb74-156"><a href="#cb74-156" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prob =</span> <span class="fl">0.8</span>)</span>
<span id="cb74-157"><a href="#cb74-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-158"><a href="#cb74-158" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(binomial_draws) <span class="sc">|&gt;</span> </span>
<span id="cb74-159"><a href="#cb74-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> binomial_draws)) <span class="sc">+</span></span>
<span id="cb74-160"><a href="#cb74-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb74-161"><a href="#cb74-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb74-162"><a href="#cb74-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Binomial Distribution: size = 7, prob = 0.8"</span>)</span>
<span id="cb74-163"><a href="#cb74-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-164"><a href="#cb74-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-165"><a href="#cb74-165" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The Uniform Distribution {.unnumbered}</span></span>
<span id="cb74-166"><a href="#cb74-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-167"><a href="#cb74-167" aria-hidden="true" tabindex="-1"></a>Whereas the binomial distribution only returns whole numbers when we sample from it, samples drawn from a uniform distribution can be any real number between a specified minimum and maximum. The uniform distribution is useful when you want to generate random numbers with equal weight from within a pre-determined range. To generate random samples from the uniform distribution we use <span class="in">`runif()`</span>. Like <span class="in">`rbinom()`</span>, the option <span class="in">`n`</span> sets the number of random draws we want. We also need to specify our range by including a <span class="in">`max`</span> and <span class="in">`min`</span>.</span>
<span id="cb74-168"><a href="#cb74-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-171"><a href="#cb74-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-172"><a href="#cb74-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating random numbers from between 0 and 1</span></span>
<span id="cb74-173"><a href="#cb74-173" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">25</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb74-174"><a href="#cb74-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-175"><a href="#cb74-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-176"><a href="#cb74-176" aria-hidden="true" tabindex="-1"></a>Let's graph the random draws we get from a uniform distribution to better understand what's taking place.</span>
<span id="cb74-177"><a href="#cb74-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-178"><a href="#cb74-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, waring=FALSE}</span></span>
<span id="cb74-179"><a href="#cb74-179" aria-hidden="true" tabindex="-1"></a>uniform_draws <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10000</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb74-180"><a href="#cb74-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-181"><a href="#cb74-181" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(uniform_draws) <span class="sc">|&gt;</span> </span>
<span id="cb74-182"><a href="#cb74-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> uniform_draws)) <span class="sc">+</span></span>
<span id="cb74-183"><a href="#cb74-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb74-184"><a href="#cb74-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb74-185"><a href="#cb74-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Unfiform Distribution: min = 0, max = 1"</span>)</span>
<span id="cb74-186"><a href="#cb74-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-187"><a href="#cb74-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-188"><a href="#cb74-188" aria-hidden="true" tabindex="-1"></a>The histogram above shows that values between 0 and 1 are all about equally likely, but we won't get any draws that are less than 0 or greater than 1. </span>
<span id="cb74-189"><a href="#cb74-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-190"><a href="#cb74-190" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The Normal Distribution {.unnumbered}</span></span>
<span id="cb74-191"><a href="#cb74-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-192"><a href="#cb74-192" aria-hidden="true" tabindex="-1"></a>The normal distribution creates the familiar bell-shaped curve and has two parameters: the mean which controls the center of the distribution, and the standard deviation which controls the width of the curve. We often model variables as following a normal distribution when we believe they should be drawn from some central value plus or minus some random "noise". Normal distributions arise naturally when the data-generating process involves the addition of many small fluctuations via some process.</span>
<span id="cb74-193"><a href="#cb74-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-194"><a href="#cb74-194" aria-hidden="true" tabindex="-1"></a>The function for generating samples from a normal distribution, <span class="in">`rnorm()`</span>, follows the same pattern we have seen with <span class="in">`rbinom()`</span> and <span class="in">`ruinf()`</span>. First we specify how many samples we want to draw <span class="in">`n`</span>, then we specify the parameters <span class="in">`mean`</span> and <span class="in">`sd`</span> of the normal distribution we want to draw from. </span>
<span id="cb74-195"><a href="#cb74-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-198"><a href="#cb74-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-199"><a href="#cb74-199" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb74-200"><a href="#cb74-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-201"><a href="#cb74-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-202"><a href="#cb74-202" aria-hidden="true" tabindex="-1"></a>Like the uniform distribution, draws from the normal distribution can be any real number. It may be difficult to see from the random draws above that values close to the mean of 0 are more likely than more extreme values. So let's take a look at the distribution graphically.</span>
<span id="cb74-203"><a href="#cb74-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-206"><a href="#cb74-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-207"><a href="#cb74-207" aria-hidden="true" tabindex="-1"></a>normal_draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb74-208"><a href="#cb74-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-209"><a href="#cb74-209" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(normal_draws) <span class="sc">|&gt;</span> </span>
<span id="cb74-210"><a href="#cb74-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> normal_draws)) <span class="sc">+</span></span>
<span id="cb74-211"><a href="#cb74-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb74-212"><a href="#cb74-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal Distribution: mean = 0, sd = 1"</span>)</span>
<span id="cb74-213"><a href="#cb74-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-214"><a href="#cb74-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-215"><a href="#cb74-215" aria-hidden="true" tabindex="-1"></a>A normal distribution that looks like the one above (mean = 0, standard deviation = 1) is often called a "Standard Normal" distribution, and you will come across it all the time in statistics. Let's take a look at some other normal distributions by varying their mean and standard deviation values.</span>
<span id="cb74-216"><a href="#cb74-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-219"><a href="#cb74-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-220"><a href="#cb74-220" aria-hidden="true" tabindex="-1"></a><span class="co"># rnorm defaults to mean = 0, sd = 1 if those options are left blank</span></span>
<span id="cb74-221"><a href="#cb74-221" aria-hidden="true" tabindex="-1"></a>normal_minus_one <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb74-222"><a href="#cb74-222" aria-hidden="true" tabindex="-1"></a>normal_zero <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb74-223"><a href="#cb74-223" aria-hidden="true" tabindex="-1"></a>normal_one <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="dv">1</span>)</span>
<span id="cb74-224"><a href="#cb74-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-225"><a href="#cb74-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining the draws into a single "long" data frame</span></span>
<span id="cb74-226"><a href="#cb74-226" aria-hidden="true" tabindex="-1"></a>normal_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(normal_minus_one,</span>
<span id="cb74-227"><a href="#cb74-227" aria-hidden="true" tabindex="-1"></a>                     normal_zero,</span>
<span id="cb74-228"><a href="#cb74-228" aria-hidden="true" tabindex="-1"></a>                     normal_one) <span class="sc">|&gt;</span> </span>
<span id="cb74-229"><a href="#cb74-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb74-230"><a href="#cb74-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb74-231"><a href="#cb74-231" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"distribution"</span>,</span>
<span id="cb74-232"><a href="#cb74-232" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"normal_draws"</span>)</span>
<span id="cb74-233"><a href="#cb74-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-234"><a href="#cb74-234" aria-hidden="true" tabindex="-1"></a>normal_data <span class="sc">|&gt;</span> </span>
<span id="cb74-235"><a href="#cb74-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> normal_draws)) <span class="sc">+</span></span>
<span id="cb74-236"><a href="#cb74-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb74-237"><a href="#cb74-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> distribution, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb74-238"><a href="#cb74-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-239"><a href="#cb74-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-240"><a href="#cb74-240" aria-hidden="true" tabindex="-1"></a>Changing the value for <span class="in">`mean`</span> shifts the distribution along the x-axis but the spread of the data remains the same.</span>
<span id="cb74-241"><a href="#cb74-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-244"><a href="#cb74-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-245"><a href="#cb74-245" aria-hidden="true" tabindex="-1"></a>normal_narrow <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb74-246"><a href="#cb74-246" aria-hidden="true" tabindex="-1"></a>normal_standard <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb74-247"><a href="#cb74-247" aria-hidden="true" tabindex="-1"></a>normal_wide <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb74-248"><a href="#cb74-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-249"><a href="#cb74-249" aria-hidden="true" tabindex="-1"></a>normal_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(normal_narrow,</span>
<span id="cb74-250"><a href="#cb74-250" aria-hidden="true" tabindex="-1"></a>                     normal_standard,</span>
<span id="cb74-251"><a href="#cb74-251" aria-hidden="true" tabindex="-1"></a>                     normal_wide) <span class="sc">|&gt;</span> </span>
<span id="cb74-252"><a href="#cb74-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb74-253"><a href="#cb74-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb74-254"><a href="#cb74-254" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"distribution"</span>,</span>
<span id="cb74-255"><a href="#cb74-255" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"normal_draws"</span>)</span>
<span id="cb74-256"><a href="#cb74-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-257"><a href="#cb74-257" aria-hidden="true" tabindex="-1"></a>normal_data <span class="sc">|&gt;</span> </span>
<span id="cb74-258"><a href="#cb74-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> normal_draws)) <span class="sc">+</span></span>
<span id="cb74-259"><a href="#cb74-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb74-260"><a href="#cb74-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> distribution, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb74-261"><a href="#cb74-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-262"><a href="#cb74-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-263"><a href="#cb74-263" aria-hidden="true" tabindex="-1"></a>Changing the value for only <span class="in">`sd`</span> keeps each distribution centered at 0, but makes the data more or less spread out.</span>
<span id="cb74-264"><a href="#cb74-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-265"><a href="#cb74-265" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling from Data {.unnumbered}</span></span>
<span id="cb74-266"><a href="#cb74-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-267"><a href="#cb74-267" aria-hidden="true" tabindex="-1"></a>While we're discussing sampling to create fake data, it's also handy to know how to sample from real data. Sometimes you will be working with data sets that are so large that you'll want to test your code on smaller portions first. Or you may want to perform sampling on data when creating bootstrapped confidence intervals (a topic we will return to at the end of this chapter).</span>
<span id="cb74-268"><a href="#cb74-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-269"><a href="#cb74-269" aria-hidden="true" tabindex="-1"></a>Let's read in the "county_elections.csv" data once again.</span>
<span id="cb74-270"><a href="#cb74-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-273"><a href="#cb74-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-274"><a href="#cb74-274" aria-hidden="true" tabindex="-1"></a>county_elections <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"county_elections.csv"</span>))</span>
<span id="cb74-275"><a href="#cb74-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-276"><a href="#cb74-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-277"><a href="#cb74-277" aria-hidden="true" tabindex="-1"></a>Dplyr contains a function called <span class="in">`sample_n()`</span> which lets you easily draw a number of random rows from your data.</span>
<span id="cb74-278"><a href="#cb74-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-281"><a href="#cb74-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-282"><a href="#cb74-282" aria-hidden="true" tabindex="-1"></a>county_elections <span class="sc">|&gt;</span> </span>
<span id="cb74-283"><a href="#cb74-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb74-284"><a href="#cb74-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-285"><a href="#cb74-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-286"><a href="#cb74-286" aria-hidden="true" tabindex="-1"></a>Alternatively, we can use <span class="in">`sample_frac()`</span> to specify how many random rows to draw based on a proportion of total rows.</span>
<span id="cb74-287"><a href="#cb74-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-290"><a href="#cb74-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-291"><a href="#cb74-291" aria-hidden="true" tabindex="-1"></a>county_elections <span class="sc">|&gt;</span> </span>
<span id="cb74-292"><a href="#cb74-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="at">size =</span> <span class="fl">0.01</span>) <span class="co"># Return 1% of the final data</span></span>
<span id="cb74-293"><a href="#cb74-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-294"><a href="#cb74-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-295"><a href="#cb74-295" aria-hidden="true" tabindex="-1"></a>Performing stratified sampling is very easy using the <span class="in">`group_by()`</span> function we introduced in the last chapter. The code below draws one random row (i.e. county) from each US state.</span>
<span id="cb74-296"><a href="#cb74-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-299"><a href="#cb74-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-300"><a href="#cb74-300" aria-hidden="true" tabindex="-1"></a>county_elections <span class="sc">|&gt;</span> </span>
<span id="cb74-301"><a href="#cb74-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_abbrv) <span class="sc">|&gt;</span> </span>
<span id="cb74-302"><a href="#cb74-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">1</span>)</span>
<span id="cb74-303"><a href="#cb74-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-304"><a href="#cb74-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-305"><a href="#cb74-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-306"><a href="#cb74-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### set.seed() {.unnumbered}</span></span>
<span id="cb74-307"><a href="#cb74-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-308"><a href="#cb74-308" aria-hidden="true" tabindex="-1"></a>If you have been running the code chunks above yourself, you may have noticed that random values you got differed from those printed in this chapter. In fact, each time you run a function like <span class="in">`rnorm(n = 100, mean = 0, sd = 1)`</span> you will get different results. The function <span class="in">`set.seed()`</span> is R's way of making sure that the results of your random simulations are the same for others, and for yourself if you re-run your code. This is an important part of making sure the results of your statistical analyses are reproducible.</span>
<span id="cb74-309"><a href="#cb74-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-310"><a href="#cb74-310" aria-hidden="true" tabindex="-1"></a>Simply put any number inside <span class="in">`set.seed()`</span> and R's randomness will become tied to that particular number. </span>
<span id="cb74-311"><a href="#cb74-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-314"><a href="#cb74-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-315"><a href="#cb74-315" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10071992</span>)</span>
<span id="cb74-316"><a href="#cb74-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-317"><a href="#cb74-317" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(my_animals, <span class="dv">3</span>)</span>
<span id="cb74-318"><a href="#cb74-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-319"><a href="#cb74-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-320"><a href="#cb74-320" aria-hidden="true" tabindex="-1"></a>Running the chunk of code above should output <span class="in">`"parrot" "cat" "monkey"`</span> each time it is run and across different computers, or different versions of R.</span>
<span id="cb74-321"><a href="#cb74-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-322"><a href="#cb74-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loops</span></span>
<span id="cb74-323"><a href="#cb74-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-324"><a href="#cb74-324" aria-hidden="true" tabindex="-1"></a>Loops are handy tools for running the same process repeatedly in R. For example, let's say we wanted to print out the name of every animal in our vector of <span class="in">`my_animals`</span>. The tedious way would be to type out the <span class="in">`print()`</span> function for each animal as in the code below.</span>
<span id="cb74-325"><a href="#cb74-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-328"><a href="#cb74-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-329"><a href="#cb74-329" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"cat"</span>)</span>
<span id="cb74-330"><a href="#cb74-330" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"dog"</span>)</span>
<span id="cb74-331"><a href="#cb74-331" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"monkey"</span>)</span>
<span id="cb74-332"><a href="#cb74-332" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"parrot"</span>)</span>
<span id="cb74-333"><a href="#cb74-333" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"fish"</span>)</span>
<span id="cb74-334"><a href="#cb74-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-335"><a href="#cb74-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-336"><a href="#cb74-336" aria-hidden="true" tabindex="-1"></a>But with loops we can perform the same task in a much more concise fashion. </span>
<span id="cb74-337"><a href="#cb74-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-340"><a href="#cb74-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-341"><a href="#cb74-341" aria-hidden="true" tabindex="-1"></a>my_animals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"monkey"</span>, <span class="st">"parrot"</span>, <span class="st">"fish"</span>)</span>
<span id="cb74-342"><a href="#cb74-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-343"><a href="#cb74-343" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (animal <span class="cf">in</span> my_animals) {</span>
<span id="cb74-344"><a href="#cb74-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(animal)</span>
<span id="cb74-345"><a href="#cb74-345" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-346"><a href="#cb74-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-347"><a href="#cb74-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-348"><a href="#cb74-348" aria-hidden="true" tabindex="-1"></a>The basic structure of a loop is shown in the code chunk below. The object <span class="in">`set_of_things`</span> should be some object in R which holds many values (such as a vector, a data frame, a list, or a matrix). The <span class="in">`thing`</span> object refers to each element in <span class="in">`set_of_things`</span> and changes its value each time the loop goes through a single iteration. Typically you will refer to <span class="in">`thing`</span> in the body of your loop, such as in the function <span class="in">`do_something_to()`</span>. A loop structured like this runs until every element in <span class="in">`set_of_things`</span> is iterated through.</span>
<span id="cb74-349"><a href="#cb74-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-350"><a href="#cb74-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb74-351"><a href="#cb74-351" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (thing <span class="cf">in</span> set_of_things) {</span>
<span id="cb74-352"><a href="#cb74-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do_something_to</span>(thing)</span>
<span id="cb74-353"><a href="#cb74-353" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-354"><a href="#cb74-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-355"><a href="#cb74-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-356"><a href="#cb74-356" aria-hidden="true" tabindex="-1"></a>It is very common to use loops as a way to run a set of R commands N times, where N is some integer greater than 1. The easiest way to do this is to create a sequence of numbers using <span class="in">`:`</span> as shown below.</span>
<span id="cb74-357"><a href="#cb74-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-360"><a href="#cb74-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-361"><a href="#cb74-361" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb74-362"><a href="#cb74-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-363"><a href="#cb74-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-364"><a href="#cb74-364" aria-hidden="true" tabindex="-1"></a>The object <span class="in">`1:10`</span> is then what we will insert into the <span class="in">`set_of_things`</span> position in our loop in order to iterate through each number in the sequence. When you construct a loop in this manner you should name your <span class="in">`thing`</span> object <span class="in">`i`</span>. This is the standard style taken from mathematical indexing, and helps readers of your code better understand the purpose of your loop.</span>
<span id="cb74-365"><a href="#cb74-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-368"><a href="#cb74-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-369"><a href="#cb74-369" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb74-370"><a href="#cb74-370" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb74-371"><a href="#cb74-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb74-372"><a href="#cb74-372" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-373"><a href="#cb74-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-374"><a href="#cb74-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-375"><a href="#cb74-375" aria-hidden="true" tabindex="-1"></a>So far our loops have only printed out their results in the console, but have not given us much to work with afterwards. To save the output of your loop you will typically need to initialize some "holder" object ahead of running the loop. Then, within each iteration of the loop, you can save the result inside the "holder" object.</span>
<span id="cb74-376"><a href="#cb74-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-379"><a href="#cb74-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-380"><a href="#cb74-380" aria-hidden="true" tabindex="-1"></a>holder <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Use NULL to create an empty object</span></span>
<span id="cb74-381"><a href="#cb74-381" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb74-382"><a href="#cb74-382" aria-hidden="true" tabindex="-1"></a>  holder[i] <span class="ot">&lt;-</span> i <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb74-383"><a href="#cb74-383" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-384"><a href="#cb74-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-385"><a href="#cb74-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-386"><a href="#cb74-386" aria-hidden="true" tabindex="-1"></a>The code chunk above iterates through each number from 1 to 100, squares that number, then saves it in the <span class="in">`i`</span>th position of the <span class="in">`holder`</span> object. We can then take the vector of values stored in <span class="in">`holder`</span> and access them as we would any object saved in our R Environment. </span>
<span id="cb74-387"><a href="#cb74-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-390"><a href="#cb74-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-391"><a href="#cb74-391" aria-hidden="true" tabindex="-1"></a>holder</span>
<span id="cb74-392"><a href="#cb74-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-393"><a href="#cb74-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-394"><a href="#cb74-394" aria-hidden="true" tabindex="-1"></a>Alternatively, we could write the functionally-equivalent code chunk below.</span>
<span id="cb74-395"><a href="#cb74-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-398"><a href="#cb74-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-399"><a href="#cb74-399" aria-hidden="true" tabindex="-1"></a>holder <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb74-400"><a href="#cb74-400" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb74-401"><a href="#cb74-401" aria-hidden="true" tabindex="-1"></a>  holder <span class="ot">&lt;-</span> <span class="fu">c</span>(holder, i <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb74-402"><a href="#cb74-402" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-403"><a href="#cb74-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-404"><a href="#cb74-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-405"><a href="#cb74-405" aria-hidden="true" tabindex="-1"></a>Here we are using the <span class="in">`c()`</span> function to *combine* the current value of the loop's iteration with everything that came before it in the <span class="in">`holder`</span> object. This method is more flexible than indexing with <span class="in">`[i]`</span>, but can be computationally slower to run because the <span class="in">`holder`</span> object is re-writen by R each time the loop iterates.</span>
<span id="cb74-406"><a href="#cb74-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-407"><a href="#cb74-407" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulations</span></span>
<span id="cb74-408"><a href="#cb74-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-409"><a href="#cb74-409" aria-hidden="true" tabindex="-1"></a>In the final section of this chapter we will look at a few examples of simulations that have real-world applications. The basic idea behind each of these simulations is to use R's random sampling functions (such as <span class="in">`rnorm()`</span> or <span class="in">`runif()`</span>) *within* a loop to generate hundreds or thousands of synthetic data points. In the real world we only get one realization of our data to analyze, but common statistical techniques are based on imagining large numbers of repeated samples of data from the same population. Simulations built in R can therefore help us approximate this process.</span>
<span id="cb74-410"><a href="#cb74-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-411"><a href="#cb74-411" aria-hidden="true" tabindex="-1"></a><span class="fu">### Central Limit Theorem {.unnumbered}</span></span>
<span id="cb74-412"><a href="#cb74-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-413"><a href="#cb74-413" aria-hidden="true" tabindex="-1"></a>The Central Limit Theorem (CLT) is invoked all the time in frequentist statistical methods. In lay terms, it states that if we calculate the means of many samples from a single population, the distribution of these means will be normally distributed. And this is true regardless (with exceptions) of what the distribution of the population looks like. If this sounds like magic to you, let's use a simulation to prove it.</span>
<span id="cb74-414"><a href="#cb74-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-417"><a href="#cb74-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-418"><a href="#cb74-418" aria-hidden="true" tabindex="-1"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb74-419"><a href="#cb74-419" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb74-420"><a href="#cb74-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-421"><a href="#cb74-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-422"><a href="#cb74-422" aria-hidden="true" tabindex="-1"></a>First we will set the number of simulations we want to run with <span class="in">`n_sims &lt;- 1000`</span>. Generally, running more simulations will produce more accurate results, but doing so will also take more computation time. The object <span class="in">`means`</span> will be our "holder" object used to store the output of each loop iteration. We set its value to <span class="in">`NULL`</span> initially because it starts empty.</span>
<span id="cb74-423"><a href="#cb74-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-426"><a href="#cb74-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-427"><a href="#cb74-427" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb74-428"><a href="#cb74-428" aria-hidden="true" tabindex="-1"></a>  sample_data <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb74-429"><a href="#cb74-429" aria-hidden="true" tabindex="-1"></a>  means[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sample_data)</span>
<span id="cb74-430"><a href="#cb74-430" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-431"><a href="#cb74-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-432"><a href="#cb74-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-433"><a href="#cb74-433" aria-hidden="true" tabindex="-1"></a>The loop above contains everything we need to simulate the CLT in action. By setting <span class="in">`for (i in 1:n_sims)`</span> we make the loop run <span class="in">`n_sims`</span> times. Within each iteration we generate a new vector of fake data called <span class="in">`sample_data`</span> which contains 100 draws of a uniform distribution whose range is from -1 to 1. We then take the average value of <span class="in">`sample_data`</span> with the <span class="in">`mean()`</span> function and store that into the <span class="in">`i`</span>th position of the <span class="in">`means`</span> holder object. </span>
<span id="cb74-434"><a href="#cb74-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-435"><a href="#cb74-435" aria-hidden="true" tabindex="-1"></a>Now let's graph our results!</span>
<span id="cb74-436"><a href="#cb74-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-439"><a href="#cb74-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-440"><a href="#cb74-440" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(means) <span class="sc">|&gt;</span> </span>
<span id="cb74-441"><a href="#cb74-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> means)) <span class="sc">+</span></span>
<span id="cb74-442"><a href="#cb74-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb74-443"><a href="#cb74-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Means from Simulated Uniform Random Samples"</span>)</span>
<span id="cb74-444"><a href="#cb74-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-445"><a href="#cb74-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-446"><a href="#cb74-446" aria-hidden="true" tabindex="-1"></a>As you can see, the distribution of mean values inside <span class="in">`means`</span> follow the familiar bell-shaped curve of a normal distribution---despite the fact that the random samples were drawn from a uniform distribution. Amazing!</span>
<span id="cb74-447"><a href="#cb74-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-448"><a href="#cb74-448" aria-hidden="true" tabindex="-1"></a><span class="fu">### Power Analysis {.unnumbered}</span></span>
<span id="cb74-449"><a href="#cb74-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-450"><a href="#cb74-450" aria-hidden="true" tabindex="-1"></a>Power analysis is a method used to figure out how big of a sample you need before running an experiment. Smaller sample sizes make it more difficult to detect an effect of some treatment, but budget constraints often limit how large of a sample we can acquire. To perform a power analysis, you need to have an idea of the possible effect sizes of your treatment, as well as your false-negative threshold (i.e. "if there really is an effect from the treatment, what proportion of times should my experiment detect it?"). Statisticians have developed fancy formulas for calculating optimal sample sizes based on these inputs. But it is much easier to instead write R code which simulates running your particular experiment thousands of times. </span>
<span id="cb74-451"><a href="#cb74-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-454"><a href="#cb74-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-455"><a href="#cb74-455" aria-hidden="true" tabindex="-1"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb74-456"><a href="#cb74-456" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb74-457"><a href="#cb74-457" aria-hidden="true" tabindex="-1"></a>effect <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb74-458"><a href="#cb74-458" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb74-459"><a href="#cb74-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-460"><a href="#cb74-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-461"><a href="#cb74-461" aria-hidden="true" tabindex="-1"></a>As in the Central Limit Theorem example, we will set <span class="in">`n_sims &lt;- 10000`</span>. Our "holder" object will be called <span class="in">`p_values`</span> this time because that is what we will be extracting from every iteration of our loop below. Lastly we need to specify a treatment effect, <span class="in">`effect`</span> and sample size for our experiment <span class="in">`sample_size`</span>. The beauty of running simulations in R is that we can easily play around with different values of <span class="in">`effect`</span> and <span class="in">`sample_size`</span> and check out the new results.</span>
<span id="cb74-462"><a href="#cb74-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-465"><a href="#cb74-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-466"><a href="#cb74-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting seed so we all get the same results</span></span>
<span id="cb74-467"><a href="#cb74-467" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10071992</span>)</span>
<span id="cb74-468"><a href="#cb74-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-469"><a href="#cb74-469" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb74-470"><a href="#cb74-470" aria-hidden="true" tabindex="-1"></a>  treated <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(sample_size <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> effect)</span>
<span id="cb74-471"><a href="#cb74-471" aria-hidden="true" tabindex="-1"></a>  control <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(sample_size <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>)</span>
<span id="cb74-472"><a href="#cb74-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-473"><a href="#cb74-473" aria-hidden="true" tabindex="-1"></a>  power_test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(treated, control)</span>
<span id="cb74-474"><a href="#cb74-474" aria-hidden="true" tabindex="-1"></a>  p_values[i] <span class="ot">&lt;-</span> power_test<span class="sc">$</span>p.value</span>
<span id="cb74-475"><a href="#cb74-475" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-476"><a href="#cb74-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-477"><a href="#cb74-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-478"><a href="#cb74-478" aria-hidden="true" tabindex="-1"></a>The loop above simulates a possible experimental design. First we create two vectors of outcomes, one for the treated group and one for our control group. The number of samples from each group is our <span class="in">`sample_size`</span> divided by two, and each group is drawn from a normal distribution using <span class="in">`rnorm()`</span>. However, you will notice that the <span class="in">`treated`</span> group is being drawn from a normal distribution with mean equal to our specified <span class="in">`effect`</span> of 0.5, whereas the <span class="in">`control`</span> group is drawn from a normal distribution with <span class="in">`mean = 0`</span>. In our simulated experiment, we *know* that the treatment has some effect because we generated the data to ensure it does! The normal distribution for each group has a standard deviation of one (the default in <span class="in">`rnorm()`</span>). The variation in outcomes has major implications for our power analysis, but we will omit dealing with that here for simplicity.</span>
<span id="cb74-479"><a href="#cb74-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-480"><a href="#cb74-480" aria-hidden="true" tabindex="-1"></a>After generating sample outcomes for our <span class="in">`treated`</span> and <span class="in">`control`</span> groups, we perform a simple t-test to compare the means of each group and store the results in an object called <span class="in">`power_test`</span>. Then we extract the p-value from the t-test using <span class="in">`$p.value`</span> and save it into the <span class="in">`i`</span>th position of the <span class="in">`p_values`</span> holder object. If <span class="in">`power_test$p.value`</span> is less than the conventional level of 0.05, then the simulated experiment has successfully detected the effect of the treatment. With our vector of 10,000 <span class="in">`p_values`</span> in hand, we can now calculate the proportion of them which are below 0.05 using the <span class="in">`mean()`</span> function.</span>
<span id="cb74-481"><a href="#cb74-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-484"><a href="#cb74-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-485"><a href="#cb74-485" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(p_values <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb74-486"><a href="#cb74-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-487"><a href="#cb74-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-488"><a href="#cb74-488" aria-hidden="true" tabindex="-1"></a>It looks like our experiment (with effect size of 0.5 and sample size of 50) was only able to detect a true effect of the treatment about 40% of the time. Ideally we would like this number to above 80% so we will probably need to recruit more than 50 participants for our experiment if we hypothesize that the treatment has a 0.5 standardized effect.</span>
<span id="cb74-489"><a href="#cb74-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-490"><a href="#cb74-490" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bootstrapping {.unnumbered}</span></span>
<span id="cb74-491"><a href="#cb74-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-492"><a href="#cb74-492" aria-hidden="true" tabindex="-1"></a>Bootstrapping is a technique used to calculate uncertainty regions around our statistical estimates. It approximates a confidence interval by re-sampling the underlying data (*with replacement*) thousands of times and refitting the statistical model to each of these samples. Bootstrapping is useful when calculating confidence intervals analytically is challenging or impossible (which may occur for complicated models). </span>
<span id="cb74-493"><a href="#cb74-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-494"><a href="#cb74-494" aria-hidden="true" tabindex="-1"></a>In this example we will be looking at the coefficient estimate for a linear regression with median household income as the dependent variable and high school percentage as the independent variable. Recall that these variables come from the <span class="in">`county_elections`</span> data.</span>
<span id="cb74-495"><a href="#cb74-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-498"><a href="#cb74-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-499"><a href="#cb74-499" aria-hidden="true" tabindex="-1"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb74-500"><a href="#cb74-500" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb74-501"><a href="#cb74-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-502"><a href="#cb74-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-503"><a href="#cb74-503" aria-hidden="true" tabindex="-1"></a>We will set <span class="in">`n_sims`</span> to only 1,000 here because the re-sampling process can take a while. The holder <span class="in">`estimates`</span> will be used to store the coefficient estimates from our linear regression.</span>
<span id="cb74-504"><a href="#cb74-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-507"><a href="#cb74-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-508"><a href="#cb74-508" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb74-509"><a href="#cb74-509" aria-hidden="true" tabindex="-1"></a>  county_sample <span class="ot">&lt;-</span> county_elections <span class="sc">|&gt;</span> </span>
<span id="cb74-510"><a href="#cb74-510" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fu">nrow</span>(county_elections), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-511"><a href="#cb74-511" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-512"><a href="#cb74-512" aria-hidden="true" tabindex="-1"></a>  lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(median_hh_inc <span class="sc">~</span> lesshs_pct,</span>
<span id="cb74-513"><a href="#cb74-513" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> county_sample)</span>
<span id="cb74-514"><a href="#cb74-514" aria-hidden="true" tabindex="-1"></a>  estimates[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)<span class="sc">$</span>coef[[<span class="dv">2</span>]]</span>
<span id="cb74-515"><a href="#cb74-515" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-516"><a href="#cb74-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-517"><a href="#cb74-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-518"><a href="#cb74-518" aria-hidden="true" tabindex="-1"></a>The first step of our simulation is to create a <span class="in">`county_sample`</span> object which contains random rows from the main <span class="in">`county_elections`</span> data set. Inside <span class="in">`sample_n()`</span> we set <span class="in">`size = nrow(county_elections)`</span> to generate a sample which has the same number of rows as the original data set. Crucially, we also set <span class="in">`replace = TRUE`</span> so that it is possible to include the same row multiple times in our sampled data. If you think it seems weird to replicate rows like this, you're not alone! Yet somehow this procedure works to produce valid confidence regions around the estimated coefficient.</span>
<span id="cb74-519"><a href="#cb74-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-520"><a href="#cb74-520" aria-hidden="true" tabindex="-1"></a>Next we create an object <span class="in">`lm_model`</span> which stores the linear regression fit on the <span class="in">`county_sample`</span> data. We can extract the coefficient/slope between <span class="in">`lesshs_pct`</span> and <span class="in">`median_hh_inc`</span> using the verbose <span class="in">`summary(lm_model)$coef[[2]]`</span> (for easier ways to extract regression coefficients see the <span class="co">[</span><span class="ot">broom package</span><span class="co">](https://broom.tidymodels.org/)</span>). </span>
<span id="cb74-521"><a href="#cb74-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-522"><a href="#cb74-522" aria-hidden="true" tabindex="-1"></a>Finally let's take a look at all these coefficient values stored in <span class="in">`estimates`</span> graphically.</span>
<span id="cb74-523"><a href="#cb74-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-526"><a href="#cb74-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-527"><a href="#cb74-527" aria-hidden="true" tabindex="-1"></a>bootstrap_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(estimates) <span class="sc">|&gt;</span> </span>
<span id="cb74-528"><a href="#cb74-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimates)) <span class="sc">+</span></span>
<span id="cb74-529"><a href="#cb74-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb74-530"><a href="#cb74-530" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb74-531"><a href="#cb74-531" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb74-532"><a href="#cb74-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Bootstrapped Estimates of the Regression Coefficient"</span>) <span class="sc">+</span></span>
<span id="cb74-533"><a href="#cb74-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb74-534"><a href="#cb74-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-535"><a href="#cb74-535" aria-hidden="true" tabindex="-1"></a>bootstrap_plot</span>
<span id="cb74-536"><a href="#cb74-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-537"><a href="#cb74-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-538"><a href="#cb74-538" aria-hidden="true" tabindex="-1"></a>Sometimes it is handy to save a ggplot graph in an object like we do with <span class="in">`bootstrap_plot`</span>. This will allow us to add on subsequent geoms without re-writing the entire ggplot code.</span>
<span id="cb74-539"><a href="#cb74-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-542"><a href="#cb74-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-543"><a href="#cb74-543" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(median_hh_inc <span class="sc">~</span> lesshs_pct,</span>
<span id="cb74-544"><a href="#cb74-544" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> county_elections)</span>
<span id="cb74-545"><a href="#cb74-545" aria-hidden="true" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)<span class="sc">$</span>coef[[<span class="dv">2</span>]]</span>
<span id="cb74-546"><a href="#cb74-546" aria-hidden="true" tabindex="-1"></a>standard_error <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)<span class="sc">$</span>coef[[<span class="dv">4</span>]]</span>
<span id="cb74-547"><a href="#cb74-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-548"><a href="#cb74-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-549"><a href="#cb74-549" aria-hidden="true" tabindex="-1"></a>How do our simulated bootstrapped estimates, fit on random samples of the <span class="in">`county_elections`</span> data, compare to the results of a model fit to the original data set? The code chunk above runs the linear regression model on the full <span class="in">`county_elections`</span> data and saves the single estimated coefficient and standard error.</span>
<span id="cb74-550"><a href="#cb74-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-553"><a href="#cb74-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-554"><a href="#cb74-554" aria-hidden="true" tabindex="-1"></a>bootstrap_plot <span class="sc">+</span></span>
<span id="cb74-555"><a href="#cb74-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> estimate,</span>
<span id="cb74-556"><a href="#cb74-556" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"maroon"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb74-557"><a href="#cb74-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> estimate <span class="sc">+</span> standard_error <span class="sc">*</span> <span class="fl">1.96</span>,</span>
<span id="cb74-558"><a href="#cb74-558" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkcyan"</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb74-559"><a href="#cb74-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> estimate <span class="sc">-</span> standard_error <span class="sc">*</span> <span class="fl">1.96</span>,</span>
<span id="cb74-560"><a href="#cb74-560" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkcyan"</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb74-561"><a href="#cb74-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Full sample estimate in maroon</span><span class="sc">\n</span><span class="st">95% confidence interval in cyan"</span>)</span>
<span id="cb74-562"><a href="#cb74-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-563"><a href="#cb74-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-564"><a href="#cb74-564" aria-hidden="true" tabindex="-1"></a>Adding these values to our <span class="in">`bootstrap_plot`</span> using <span class="in">`+ geom_vline()`</span> we can see that the bootstrapped estimates correspond neatly to the full-data model! The center of the bootstrapped distribution is right on the full-data model estimate of the coefficient, and roughly 95% of our simulated results fall within </span>
<span id="cb74-565"><a href="#cb74-565" aria-hidden="true" tabindex="-1"></a>$\pm 1.96 \times \mathrm{StandardError}$</span>
<span id="cb74-566"><a href="#cb74-566" aria-hidden="true" tabindex="-1"></a>(the definition of a confidence interval for a linear regression coefficient).</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>